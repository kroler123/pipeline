#!groovy
// Check properties
properties([disableConcurrentBuilds()])

pipeline {
	agent {
		label 'master'
	}
	options {
		buildDiscarder(logRotator(numToKeepStr: '10', artifactNumToKeepStr: '10'))
		timestamps()
		skipStagesAfterUnstable()
	}
	stages {
                stage("first step") {
                        steps {
                                sh 'ssh -i '/var/lib/jenkins/.ssh/ats_rsa' root@10.20.1.20 \'hostname\''
                        }
                }
		stage("Second step") {
			steps {
				sh 'hostname'
			}
		}
		stage("Three step") {
			steps {
				ansiblePlaybook('/etc/ansible/playbook_ats_test.yml') {
					hostKeyChecking (false)
					inventoryPath('/etc/ansible/hosts')
					ansibleName('0.1')
					become(true)
				}
			}
		}
	}
}
